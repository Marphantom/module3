CREATE DATABASE ThucTap

CREATE TABLE KHOA
(
	MAKHOA			VARCHAR(10)		NOT NULL	PRIMARY KEY,
	TENKHOA			NVARCHAR(50)	NOT NULL,
	DIENTHOAI		VARCHAR(10)		NOT NULL
)

CREATE TABLE GiangVien
(
	MAGV			INT				NOT NULL	PRIMARY KEY,
	HOTENGV			NVARCHAR(50)	NOT NULL,
	LUONG			DECIMAL(5,2)	NOT NULL,
	MAKHOA			VARCHAR(10)		NOT NULL,
	FOREIGN KEY (MAKHOA)	REFERENCES	KHOA(MAKHOA)
)

CREATE TABLE SinhVien
(
	MASV			INT				NOT NULL	PRIMARY KEY,
	HOTENSV			NVARCHAR(50)	NOT NULL,
	MAKHOA			VARCHAR(10)		NOT NULL,
	NAMSINH			INT				NOT NULL,
	QUEQUAN			NVARCHAR(30)	NOT NULL
)

CREATE TABLE DeTai
(
	MADT			VARCHAR(10)		NOT NULL	PRIMARY KEY,
	TENDT			NVARCHAR(100)	NOT NULL,
	KINHPHI			INT,
	NOITHUCTAP		NVARCHAR(50)
)

CREATE TABLE HuongDan
(
	MASV			INT				NOT NULL,
	FOREIGN KEY (MASV)		REFERENCES	SinhVien(MASV),
	MADT			VARCHAR(10)		NOT NULL,
	FOREIGN KEY (MADT)	REFERENCES	DeTai(MADT),
	MAGV			INT				NOT NULL,
	FOREIGN KEY (MAGV)	REFERENCES	GiangVien(MAGV),
	KETQUA			DECIMAL(5,2)
)

INSERT INTO KHOA(MAKHOA, TENKHOA, DIENTHOAI) VALUES('T01',N'TOÁN','0123456789')
INSERT INTO KHOA(MAKHOA, TENKHOA, DIENTHOAI) VALUES('V02',N'VĂN','0987654321')
INSERT INTO KHOA(MAKHOA, TENKHOA, DIENTHOAI) VALUES('D03',N'ĐỊA LÝ','0246813579')
INSERT INTO KHOA(MAKHOA, TENKHOA, DIENTHOAI) VALUES('H04',N'HÓA','0135792468')
SELECT * FROM KHOA

INSERT INTO GiangVien(MAGV,HOTENGV,LUONG,MAKHOA) VALUES (1,N'NGUYỄN VĂN A',500,'T01')
INSERT INTO GiangVien(MAGV,HOTENGV,LUONG,MAKHOA) VALUES (2,N'NGUYỄN VĂN B',450,'V02')
INSERT INTO GiangVien(MAGV,HOTENGV,LUONG,MAKHOA) VALUES (3,N'NGUYỄN VĂN C',550,'D03')
INSERT INTO GiangVien(MAGV,HOTENGV,LUONG,MAKHOA) VALUES (4,N'NGUYỄN VĂN D',300,'H04')
SELECT * FROM GiangVien

INSERT INTO SinhVien(MASV,HOTENSV,MAKHOA,NAMSINH,QUEQUAN) VALUES(1,N'NGUYÊN','T01',1993,N'HUẾ')
INSERT INTO SinhVien(MASV,HOTENSV,MAKHOA,NAMSINH,QUEQUAN) VALUES(2,N'HUY','V02',1996,'HCM')
INSERT INTO SinhVien(MASV,HOTENSV,MAKHOA,NAMSINH,QUEQUAN) VALUES(3,N'LONG','D03',1997,N'QUẢNG TRỊ')
INSERT INTO SinhVien(MASV,HOTENSV,MAKHOA,NAMSINH,QUEQUAN) VALUES(4,N'NAM','H04',1996,N'ĐÀ NẴNG')
SELECT * FROM SinhVien

INSERT INTO DeTai(MADT,TENDT,KINHPHI,NOITHUCTAP) VALUES ('DT01',N'PHƯƠNG TRÌNH BẬC 2',100,N'HUẾ')
INSERT INTO DeTai(MADT,TENDT,KINHPHI,NOITHUCTAP) VALUES ('DT02',N'PHÂN TÍCH BÀI THƠ ĐẤT NƯỚC',500,N'HCM')
INSERT INTO DeTai(MADT,TENDT,KINHPHI,NOITHUCTAP) VALUES ('DT03',N'TẦNG OZON Ở BẮC CỰC',900,N'ĐÀ NẴNG')
INSERT INTO DeTai(MADT,TENDT,KINHPHI,NOITHUCTAP) VALUES ('DT04',N'CHẤT HỮU CƠ',800,N'HÀ NỘI')
SELECT * FROM DeTai

INSERT INTO HuongDan(MASV,MADT,MAGV,KETQUA) VALUES (1,'DT01',1,10)
INSERT INTO HuongDan(MASV,MADT,MAGV,KETQUA) VALUES (2,'DT02',2,9)
INSERT INTO HuongDan(MASV,MADT,MAGV,KETQUA) VALUES (3,'DT03',3,9)
INSERT INTO HuongDan(MASV,MADT,MAGV,KETQUA) VALUES (4,'DT04',4,10)
SELECT * FROM HuongDan


SELECT GV.MAGV, GV.HOTENGV, K.TENKHOA 
FROM  GiangVien GV INNER JOIN KHOA K ON GV.MAKHOA = K.MAKHOA

SELECT GV.MAGV, GV.HOTENGV, K.TENKHOA 
FROM  GiangVien GV INNER JOIN KHOA K ON GV.MAKHOA = K.MAKHOA
WHERE K.TENKHOA IN ('ĐỊA LÝ','HÓA')

SELECT SV.HOTENSV
FROM  SinhVien SV INNER JOIN KHOA K ON SV.MAKHOA = K.MAKHOA
WHERE K.TENKHOA = 'HÓA'

SELECT SV.MASV, HOTENSV,SV.NAMSINH
FROM  SinhVien SV INNER JOIN KHOA K ON SV.MAKHOA = K.MAKHOA
WHERE K.TENKHOA = 'TOÁN'

SELECT K.DIENTHOAI
FROM  SinhVien SV INNER JOIN KHOA K ON SV.MAKHOA = K.MAKHOA
WHERE SV.HOTENSV='HUY'


SELECT DT.MADT,DT.TENDT,GV.HOTENGV
FROM HuongDan HD INNER JOIN GiangVien GV ON HD.MAGV = GV.MAGV
				 INNER JOIN DeTai DT ON HD.MADT = DT.MADT
WHERE GV.HOTENGV = N'NGUYỄN VĂN C'

SELECT SV.MASV,SV.HOTENSV,SV.QUEQUAN,DT.NOITHUCTAP
FROM HuongDan HD INNER JOIN SinhVien SV ON HD.MAGV = SV.MASV
				 INNER JOIN DeTai DT ON HD.MADT = DT.MADT
WHERE SV.QUEQUAN = DT.NOITHUCTAP

CREATE PROCEDURE  SpThemSV 
(	@MASV					INT	,
	@HOTENSV			NVARCHAR(50),
	@MAKHOA			VARCHAR(10),
	@NAMSINH			INT,
	@QUEQUAN			NVARCHAR(30)	
)
AS 
BEGIN
INSERT INTO dbo.SinhVien
(
    MASV,
    HOTENSV,
    MAKHOA,
    NAMSINH,
    QUEQUAN
)
VALUES
(  
	@MASV	,
	@HOTENSV,
	@MAKHOA,
	@NAMSINH,
	@QUEQUAN
)
END

DROP PROCEDURE SpThemSV

EXECUTE SpThemSV 7,N'Thu', 'K01', 1996, N'Ha Noi'

CREATE PROCEDURE  Sp_Xoa_SV 
(
	@MASV INT
)
AS
BEGIN
DELETE FROM dbo.SinhVien
WHERE MASV = @MASV
END

EXECUTE Sp_Xoa_SV 7

